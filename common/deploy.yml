# Another option is to list that tasks in `hosts: all` section,
# but we also need same tasks in compute node which is built differently
# so use include.

- name: Import InfluxData GPG signing key
  apt_key:
    url: https://repos.influxdata.com/influxdb.key
    state: present
  become: true

- name: Add InfluxData repository
  apt_repository:
    repo: deb https://repos.influxdata.com/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} stable
    state: present
  become: true

- name: Install Telegraf packages
  apt:
    name: telegraf
    state: latest
  become: true

- name: Telegraf common config
  copy:
    src: telegraf.conf
    dest: /etc/telegraf/telegraf.conf
    owner: telegraf
    group: telegraf
  become: true

# Different node types may add custom inputs for telegraf, so
# let playbook start telegraf service itself

- name: Install prometheus-node-exporter
  apt:
    name: prometheus-node-exporter
    state: latest
  become: true
